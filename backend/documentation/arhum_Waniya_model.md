# DeenTales Backend - User Model Documentation

**Authors:** Arhum & Waniya  
**Date:** December 14, 2025  
**Branch:** `backend`

---

## ğŸ“‹ Overview

This document explains the backend setup for DeenTales, specifically the **User Model** for MongoDB using FastAPI and Beanie ODM.

---

## ğŸ—‚ï¸ Backend Folder Structure

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # FastAPI entry point
â”‚   â”œâ”€â”€ config.py            # Settings (reads from .env automatically)
â”‚   â”œâ”€â”€ database.py          # MongoDB connection setup
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ user.py          # â­ USER MODEL (main work)
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ user.py          # Pydantic validation schemas
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ password.py      # Password hashing utilities
â”œâ”€â”€ venv/                    # Virtual environment (don't commit to git)
â”œâ”€â”€ .env.example             # Template for environment variables
â”œâ”€â”€ requirements.txt         # Python dependencies
â””â”€â”€ README.md                # Setup instructions
```

---

## ğŸ‘¤ User Model

### Location: `backend/app/models/user.py`

### Fields

| Field | Type | Description | Constraints |
|-------|------|-------------|-------------|
| `id` | ObjectId | Primary Key | Auto-generated by MongoDB |
| `username` | String | User's display name | Min: 3, Max: 50 characters |
| `password` | String | Hashed password | Min: 8 characters |
| `email` | EmailStr | User's email | **Unique**, Indexed |
| `created_at` | DateTime | Account creation time | Auto-set on creation |
| `updated_at` | DateTime | Last update time | Optional |

### Code

```python
from beanie import Document
from beanie.odm.fields import Indexed
from pydantic import EmailStr, Field
from typing import Optional
from datetime import datetime, timezone


class User(Document):
    username: str = Field(..., min_length=3, max_length=50)
    password: str = Field(..., min_length=8)
    email: Indexed(EmailStr, unique=True)
    created_at: datetime = Field(default_factory=lambda: datetime.now(timezone.utc))
    updated_at: Optional[datetime] = None

    class Settings:
        name = "users"  # MongoDB collection name
```

---

## ğŸ“ Pydantic Schemas

### Location: `backend/app/schemas/user.py`

These schemas are for **request/response validation**. Use them in your API routes.

### UserCreate (for Signup)
```python
class UserCreate(BaseModel):
    username: str = Field(..., min_length=3, max_length=50)
    password: str = Field(..., min_length=8)
    email: EmailStr
```

### UserLogin
```python
class UserLogin(BaseModel):
    email: EmailStr
    password: str
```

### UserResponse (for API responses - excludes password)
```python
class UserResponse(BaseModel):
    id: str
    username: str
    email: EmailStr
    created_at: datetime
    updated_at: Optional[datetime] = None
```

---

## ğŸ” Password Utilities

### Location: `backend/app/utils/password.py`

**Never store plain text passwords!** Use these functions:

```python
from app.utils import hash_password, verify_password

# When user signs up - hash the password before saving
hashed = hash_password("user_plain_password")

# When user logs in - verify password
is_valid = verify_password("user_input_password", stored_hashed_password)
```

---

## âš™ï¸ Configuration

### Location: `backend/app/config.py`

The config uses `pydantic-settings` which **automatically reads from `.env` file**.

```python
from app.config import settings

# Access configuration values
settings.MONGODB_URL      # Your MongoDB connection string
settings.DATABASE_NAME    # Database name (default: deentales)
```

### How to set up `.env`

1. Copy `.env.example` to `.env`
2. Fill in your values:

```env
MONGODB_URL=mongodb://localhost:27017
DATABASE_NAME=deentales
```

For MongoDB Atlas:
```env
MONGODB_URL=mongodb+srv://username:password@cluster.mongodb.net
DATABASE_NAME=deentales
```

---

## ğŸ—„ï¸ Database Connection

### Location: `backend/app/database.py`

The `init_db()` function:
1. Connects to MongoDB using Motor (async driver)
2. Initializes Beanie ODM with document models
3. **Creates collections automatically** when you first save data

```python
from app.database import init_db

# Called automatically on app startup (see main.py)
await init_db()
```

---

## ğŸš€ How to Run the Backend

### Step 1: Navigate to backend folder
```bash
cd D:\deentales\backend
```

### Step 2: Activate virtual environment
```powershell
# Windows PowerShell
.\venv\Scripts\Activate.ps1

# Windows CMD
.\venv\Scripts\activate.bat

# Linux/Mac
source venv/bin/activate
```

### Step 3: Install dependencies (if not already)
```bash
pip install -r requirements.txt
```

### Step 4: Create `.env` file
```bash
# Copy the example
cp .env.example .env

# Edit with your MongoDB settings
```

### Step 5: Start MongoDB
Make sure MongoDB is running locally, or use MongoDB Atlas connection string.

### Step 6: Run the server
```bash
uvicorn app.main:app --reload
```

### Step 7: Access the API
- **API:** http://localhost:8000
- **Swagger Docs:** http://localhost:8000/docs
- **Health Check:** http://localhost:8000/health

---

## ğŸ“¦ Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| fastapi | â‰¥0.115.0 | Web framework |
| uvicorn | â‰¥0.32.0 | ASGI server |
| motor | â‰¥3.6.0 | Async MongoDB driver |
| beanie | â‰¥1.27.0 | MongoDB ODM |
| pydantic | â‰¥2.10.0 | Data validation |
| pydantic-settings | â‰¥2.6.0 | Config from .env |
| passlib[bcrypt] | â‰¥1.7.4 | Password hashing |
| email-validator | â‰¥2.2.0 | Email validation |

---

## ğŸ”§ How to Use the User Model (For Teammates)

### Example: Create a new user

```python
from app.models import User
from app.utils import hash_password

async def create_user(username: str, email: str, password: str):
    # Hash the password before saving
    hashed_password = hash_password(password)
    
    # Create user document
    user = User(
        username=username,
        email=email,
        password=hashed_password
    )
    
    # Save to MongoDB (collection created automatically)
    await user.insert()
    
    return user
```

### Example: Find user by email

```python
async def get_user_by_email(email: str):
    user = await User.find_one(User.email == email)
    return user
```

### Example: Verify login

```python
from app.utils import verify_password

async def login(email: str, password: str):
    user = await User.find_one(User.email == email)
    
    if not user:
        return None  # User not found
    
    if not verify_password(password, user.password):
        return None  # Wrong password
    
    return user  # Login successful
```

### Example: Update user

```python
from datetime import datetime, timezone

async def update_username(user_id: str, new_username: str):
    user = await User.get(user_id)
    user.username = new_username
    user.updated_at = datetime.now(timezone.utc)
    await user.save()
    return user
```

---

## ğŸ“Œ Important Notes

1. **Virtual Environment:** Always activate venv before working
2. **Password Security:** Never store plain passwords - always hash them
3. **Email Uniqueness:** The email field has a unique index - duplicate emails will throw an error
4. **Auto-creation:** MongoDB collections are created automatically on first insert
5. **CORS:** Frontend URLs (localhost:5173, localhost:3000) are already allowed in `main.py`

---

## ğŸ”— Related Files

- Frontend Auth Service: `frontend/src/services/authService.js`
- Frontend Auth Context: `frontend/src/context/AuthContext.jsx`
- Login Page: `frontend/src/pages/Login/Login.jsx`
- Signup Page: `frontend/src/pages/Signup/Signup.jsx`

---

## âœ… What's Done

- [x] Virtual environment setup
- [x] All dependencies installed
- [x] User model with all required fields
- [x] Pydantic schemas for validation
- [x] Password hashing utilities
- [x] MongoDB connection setup
- [x] FastAPI app with CORS configured
- [x] Health check endpoints

## ğŸ“ What's Left (For Teammates)

- [ ] Create auth routes (`/api/auth/signup`, `/api/auth/login`)
- [ ] Implement JWT token authentication
- [ ] Create logout functionality
- [ ] Add password reset feature
- [ ] Connect frontend to backend API

---

## ğŸ¤ Contact

If you have questions about this setup, contact **Arhum** or **Waniya**.
